# Apache Alias Configuration for Roaya Clinic
# This configuration allows access via both direct IP and /clinic path
# Add this to your main Apache configuration or include it

<VirtualHost *:80>
    # Main server configuration
    ServerName 192.168.40.128
    DocumentRoot /var/www/html
    
    # Clinic alias configuration
    Alias /clinic/public /var/www/html/clinic/public
    
    <Directory /var/www/html/clinic/public>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
        
        # URL Rewriting
        RewriteEngine On
        
        # Handle Authorization Header
        RewriteCond %{HTTP:Authorization} .
        RewriteRule .* - [E=HTTP_AUTHORIZATION:%{HTTP:Authorization}]
        
        # Redirect Trailing Slashes If Not A Folder
        RewriteCond %{REQUEST_FILENAME} !-d
        RewriteCond %{REQUEST_URI} (.+)/$
        RewriteRule ^ %1 [L,R=301]
        
        # Send Requests To Front Controller
        RewriteCond %{REQUEST_FILENAME} !-d
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteRule ^ index.php [L,QSA]
    </Directory>
    
    # Redirect /clinic to /clinic/public
    RedirectMatch ^/clinic/?$ /clinic/public/
    
    # Security: Block access to sensitive directories
    <DirectoryMatch "/var/www/html/clinic/(app|config|storage|vendor|sql)">
        Require all denied
    </DirectoryMatch>
    
    # Block sensitive files
    <Files ".env">
        Require all denied
    </Files>
    
    <Files "composer.*">
        Require all denied
    </Files>
    
    <Files "*.md">
        Require all denied
    </Files>
    
    # Security Headers
    <IfModule mod_headers.c>
        Header always set X-Content-Type-Options nosniff
        Header always set X-Frame-Options DENY
        Header always set X-XSS-Protection "1; mode=block"
        Header always set Referrer-Policy "strict-origin-when-cross-origin"
        Header always set Permissions-Policy "geolocation=(), microphone=(), camera=()"
    </IfModule>
    
    # Logging
    ErrorLog ${APACHE_LOG_DIR}/clinic_error.log
    CustomLog ${APACHE_LOG_DIR}/clinic_access.log combined
</VirtualHost>
