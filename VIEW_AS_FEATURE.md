# View As Feature - خاصية استعراض الأدوار

## نظرة عامة
خاصية "View As" تسمح للمديرين (Admins) باستعراض واجهة كل دور في النظام كما يراها المستخدمون العاديون. هذه الخاصية مفيدة جداً لفهم تجربة المستخدم واختبار الوظائف المختلفة.

## الميزات

### 1. استعراض واجهة الطبيب
- يمكن للمدير استعراض لوحة تحكم الطبيب
- الوصول لجميع وظائف الطبيب (المرضى، المواعيد، التقارير)
- رؤية البيانات كما يراها الطبيب الفعلي

### 2. استعراض واجهة السكرتير
- يمكن للمدير استعراض لوحة تحكم السكرتير
- الوصول لجميع وظائف السكرتير (الحجوزات، المدفوعات، المرضى)
- رؤية البيانات كما يراها السكرتير الفعلي

### 3. مؤشرات بصرية واضحة
- مؤشر في أعلى الصفحة يوضح أن المدير في وضع "View As"
- إمكانية العودة لواجهة الإدارة بسهولة
- تحذيرات واضحة عند الاستخدام

## كيفية الاستخدام

### 1. بدء استعراض دور معين
1. ادخل لوحة تحكم الإدارة
2. ابحث عن قسم "View As - استعراض واجهة الأدوار"
3. اختر الدور المطلوب (طبيب أو سكرتير)
4. اضغط على "استعراض واجهة [الدور]"

### 2. العودة لواجهة الإدارة
- اضغط على زر "العودة لواجهة الإدارة" في أعلى الصفحة
- أو اضغط على "Exit" في المؤشر البصري

## الأمان

### 1. قيود الوصول
- فقط المديرون يمكنهم استخدام هذه الخاصية
- لا يمكن للمستخدمين العاديين الوصول لهذه الوظيفة

### 2. حماية البيانات
- المدير يحتفظ بصلاحياته الكاملة أثناء الاستعراض
- لا يمكن تعديل البيانات الحساسة إلا بصلاحيات المدير

### 3. تتبع الأنشطة
- جميع الأنشطة يتم تسجيلها في سجل التدقيق
- يمكن تتبع من استخدم خاصية View As ومتى

## الملفات المعدلة

### 1. Auth Class (`app/Lib/Auth.php`)
- إضافة methods للتحكم في View As mode
- تحديث `requireRole` لدعم View As
- إضافة `getCurrentRole`, `isViewAsMode`, `startViewAs`, `stopViewAs`

### 2. AdminController (`app/Controllers/AdminController.php`)
- إضافة `viewAs()` method لبدء الاستعراض
- إضافة `stopViewAs()` method للعودة
- إضافة `getViewAsStatus()` method للحصول على حالة الاستعراض

### 3. Router (`public/index.php`)
- إضافة routes للـ View As functionality
- `/admin/view-as?role=[role]` - بدء الاستعراض
- `/admin/stop-view-as` - إيقاف الاستعراض

### 4. Views
- تحديث `admin/dashboard.php` لإضافة واجهة View As
- تحديث `layouts/main.php` لإضافة المؤشر البصري

### 5. Controllers الأخرى
- تحديث `DoctorController` و `SecretaryController` لدعم View As mode

## Routes الجديدة

```
GET /admin/view-as?role=doctor     - استعراض واجهة الطبيب
GET /admin/view-as?role=secretary  - استعراض واجهة السكرتير
GET /admin/stop-view-as            - العودة لواجهة الإدارة
```

## الاستخدام التقني

### بدء View As mode
```php
$auth = new \App\Lib\Auth();
$auth->startViewAs('doctor'); // أو 'secretary'
```

### التحقق من View As mode
```php
if ($auth->isViewAsMode()) {
    $currentRole = $auth->getCurrentRole();
    $originalRole = $auth->getOriginalRole();
}
```

### إيقاف View As mode
```php
$auth->stopViewAs();
```

## ملاحظات مهمة

1. **الأمان**: هذه الخاصية مخصصة للمديرين فقط
2. **البيانات**: المدير يحتفظ بجميع صلاحياته أثناء الاستعراض
3. **التتبع**: جميع الأنشطة يتم تسجيلها
4. **الواجهة**: مؤشرات بصرية واضحة تظهر حالة الاستعراض

## التطوير المستقبلي

- إضافة إمكانية استعراض أدوار أخرى
- تحسين واجهة الاستعراض
- إضافة تقارير عن استخدام View As
- إضافة إعدادات للتحكم في صلاحيات View As
