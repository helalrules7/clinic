# نظام الرصيد اليومي الجديد

## نظرة عامة
تم إعادة تصميم نظام المدفوعات بالكامل ليشمل نظام الرصيد اليومي المتقدم مع الميزات التالية:

### الميزات الجديدة:
1. **الرصيد اليومي** - عرض إجمالي المدفوعات اليوم
2. **تسجيل الرصيد اليومي** - إمكانية تسجيل الرصيد الافتتاحي والإضافي
3. **الإغلاق اليومي** - للطبيب فقط لإغلاق اليوم وبدء يوم جديد
4. **عرض سجلات المدفوعات** مع الأنواع الجديدة

## التحديثات المطلوبة:

### 1. تحديث قاعدة البيانات
```sql
-- تشغيل ملف SQL التالي:
source database_updates/add_daily_balances_table.sql
```

### 2. الملفات المحدثة:
- `app/Views/secretary/payments.php` - صفحة المدفوعات الجديدة
- `app/Lib/View.php` - دوال مساعدة جديدة
- `app/Controllers/SecretaryController.php` - منطق الرصيد اليومي
- `app/Controllers/ApiController.php` - API endpoints جديدة
- `index.php` - routes جديدة

### 3. الجداول الجديدة:
- `daily_balances` - لتسجيل الرصيد اليومي
- `daily_closures` - لإغلاق اليوم

### 4. API Endpoints الجديدة:
- `POST /api/daily-balance` - تسجيل رصيد يومي
- `POST /api/daily-closure` - إغلاق اليوم (للطبيب فقط)

## كيفية الاستخدام:

### للمساعدين (Secretary):
1. **تسجيل الرصيد الافتتاحي**: اضغط على "تسجيل رصيد" في بداية اليوم
2. **عرض الرصيد الحالي**: يظهر في أعلى الصفحة
3. **عرض سجلات المدفوعات**: مع التصنيف حسب النوع

### للأطباء (Doctor):
1. **جميع ميزات المساعدين**
2. **إغلاق اليوم**: زر "إغلاق اليوم" لإغلاق اليوم وبدء يوم جديد

## أنواع المدفوعات الجديدة:
- **حجز جديد** (New Booking)
- **إعادة كشف** (Follow-up)
- **استشارة طبية** (Consultation)
- **إجراء طبي** (Procedure)

## اختصارات لوحة المفاتيح:
- `R` أو `ر` - تسجيل رصيد
- `F` أو `ب` - البحث
- `Esc` - إغلاق النوافذ المنبثقة

## ملاحظات مهمة:
- الإغلاق اليومي متاح للطبيب فقط
- عند الإغلاق اليومي، يبدأ اليوم التالي برصيد صفر
- جميع المعاملات محفوظة في قاعدة البيانات
- النظام يدعم البحث والفلترة المتقدمة
